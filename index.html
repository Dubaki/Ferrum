<script>
    // ===== МИНИМАЛЬНАЯ ИНИЦИАЛИЗАЦИЯ =====
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    // ===== КОНФИГУРАЦИЯ N8N (TEST URL) =====
    const N8N_CONFIG = {
        webhookUrl: 'https://abidmumetoy.beget.app/webhook-test/ferrum-order', // <-- УБЕДИТЕСЬ, ЧТО ЗДЕСЬ TEST URL
    };

    // ===== МИНИМАЛЬНАЯ ФУНКЦИЯ ОТПРАВКИ =====
    async function sendMinimalTest() {
        console.log('Нажата кнопка Отправить (Минимальный тест)');
        alert('Попытка отправить тестовые данные на:\n' + N8N_CONFIG.webhookUrl); // Используем alert для диагностики

        const testPayload = {
            message: "Минимальный тест из TWA",
            timestamp: new Date().toISOString(),
            userId: tg.initDataUnsafe?.user?.id || 'N/A (Не из Telegram)', // Пытаемся получить ID
            testUrlUsed: N8N_CONFIG.webhookUrl
        };

        try {
            const response = await fetch(N8N_CONFIG.webhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(testPayload)
            });

            console.log('Статус ответа (Минимальный тест):', response.status);
            alert('Статус ответа от N8N: ' + response.status); // Показываем статус

            // Не пытаемся читать JSON, так как Test URL дает пустой ответ
            if (tg.close) {
               setTimeout(tg.close, 1000); // Закрываем через 1 сек
            }


        } catch (error) {
            console.error('Ошибка fetch (Минимальный тест):', error);
            alert('Ошибка отправки fetch:\n' + error.message); // Показываем ошибку
        }
    }

    // ===== ОБРАБОТЧИК ДЛЯ КНОПКИ (Упрощенный) =====
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM загружен (Минимальный тест)');

        // Находим ТОЛЬКО кнопку отправки печи и вешаем на нее ТЕСТОВЫЙ обработчик
        const submitOvenBtn = document.getElementById('submitOvenBtn');
        if (submitOvenBtn) {
            console.log('Кнопка submitOvenBtn найдена');
            // Удаляем старые обработчики на всякий случай
            submitOvenBtn.replaceWith(submitOvenBtn.cloneNode(true));
            // Находим кнопку заново после клонирования
            const newSubmitOvenBtn = document.getElementById('submitOvenBtn');
            if (newSubmitOvenBtn) {
               newSubmitOvenBtn.addEventListener('click', sendMinimalTest);
               console.log('Обработчик sendMinimalTest добавлен к кнопке');
            } else {
               console.error('Клонированная кнопка submitOvenBtn не найдена');
            }
        } else {
            console.error('Кнопка submitOvenBtn НЕ найдена!');
        }

         // Упрощенная навигация, чтобы можно было дойти до формы печи
         document.querySelectorAll('.card[data-screen="ovenScreen"]').forEach(card => {
            card.addEventListener('click', function() {
                document.getElementById('mainScreen').classList.add('hidden');
                const ovenScreen = document.getElementById('ovenScreen');
                if (ovenScreen) ovenScreen.classList.remove('hidden');
            });
         });
          const backBtn = document.querySelector('.back-btn[data-back="mainScreen"]');
          if (backBtn) {
             backBtn.addEventListener('click', function() {
                 const ovenScreen = document.getElementById('ovenScreen');
                 if (ovenScreen) ovenScreen.classList.add('hidden');
                 document.getElementById('mainScreen').classList.remove('hidden');
             });
          }


        console.log('Минимальный скрипт загружен');
        console.log('Текущий URL N8N:', N8N_CONFIG.webhookUrl);
    });
</script>
